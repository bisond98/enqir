var m=Object.defineProperty;var I=(r,e,t)=>e in r?m(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e,t)=>I(r,typeof e!="symbol"?e+"":e,t);import{d as l,u as g,s as v,a as d,b as p,g as D}from"./index-BjPfBPAr.js";const n=class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}async analyzeEnquiry(e){try{console.log(" AI: Analyzing enquiry:",e.title);const t=await l.checkForDuplicates(e.title,e.description,e.userId);if(t.isDuplicate){console.log(" AI: Duplicate detected - flagging for manual review");const c=l.getDuplicateIds(t.matches);return{approved:!1,confidence:0,reason:"Potential duplicate enquiry detected - requires manual review",aiNotes:l.formatDuplicateReason(t),isDuplicate:!0,duplicateMatches:c}}const a={hasValidTitle:this.validateTitle(e.title),hasValidDescription:this.validateDescription(e.description),hasValidCategory:this.validateCategory(e.category),hasValidBudget:this.validateBudget(e.budget),hasValidLocation:this.validateLocation(e.location),isNotSpam:this.detectSpam(e.title,e.description),isNotInappropriate:this.detectInappropriateContent(e.title,e.description),hasReasonableDeadline:this.validateDeadline(e.deadline),isComplete:this.checkCompleteness(e)};console.log(" AI: Analysis results:",a);const i=this.calculateConfidence(a),s=i>=.8,o=this.generateReason(a,i);return console.log(` AI: Decision - Approved: ${s}, Confidence: ${i}%, Reason: ${o}`),{approved:s,confidence:i,reason:o,aiNotes:`AI Analysis: ${Object.entries(a).map(([c,f])=>`${c}: ${f}`).join(", ")}`,isDuplicate:!1,duplicateMatches:[]}}catch(t){return console.error(" AI: Error analyzing enquiry:",t),{approved:!1,confidence:0,reason:"AI analysis failed - requires manual review",aiNotes:`AI Error: ${t}`,isDuplicate:!1,duplicateMatches:[]}}}async processEnquiry(e,t){try{if(console.log(" AI: Processing enquiry for approval:",e),!await this.isAIEnabled())return console.log(" AI: AI approval is disabled - sending to manual review"),await this.sendToManualReview(e,"AI approval disabled"),!1;const i=await this.analyzeEnquiry(t);return i.approved?(await this.autoApproveEnquiry(e,i),console.log(" AI: Enquiry auto-approved by AI"),!0):(await this.sendToManualReview(e,i.reason,i.aiNotes,i.isDuplicate,i.duplicateMatches),console.log(" AI: Enquiry sent to manual review"),!1)}catch(a){return console.error(" AI: Error processing enquiry:",a),await this.sendToManualReview(e,"AI processing error"),!1}}async autoApproveEnquiry(e,t){await g(d(p,"enquiries",e),{status:"live",adminNotes:`AI Approved (${t.confidence}% confidence) - ${t.reason}`,aiNotes:t.aiNotes,approvedAt:v(),approvedBy:"AI",approvalMethod:"ai"})}async sendToManualReview(e,t,a,i,s){const o={status:"pending",adminNotes:`Manual review required - ${t}`,aiNotes:a,requiresManualReview:!0,aiRejectionReason:t};i&&s&&(o.isDuplicate=!0,o.duplicateMatches=s,o.duplicateDetectedAt=v()),await g(d(p,"enquiries",e),o)}async isAIEnabled(){try{const e=await D(d(p,"settings","ai_approval"));return e.exists()?e.data().enabled??!0:!0}catch(e){return console.error(" AI: Error checking AI settings:",e),!0}}validateTitle(e){return e&&e.trim().length>=10&&e.trim().length<=200}validateDescription(e){return e&&e.trim().length>=20&&e.trim().length<=2e3}validateCategory(e){return["Electronics","Fashion","Home & Garden","Automotive","Sports","Books","Toys","Health","Beauty","Other"].includes(e)}validateBudget(e){return e&&e>0&&e<=1e6}validateLocation(e){return e?e.trim().length>=2&&e.trim().length<=100:!0}detectSpam(e,t){const a=["free","urgent","quick","easy money","get rich","click here","buy now"],i=(e+" "+t).toLowerCase();return!a.some(s=>i.includes(s))}detectInappropriateContent(e,t){const a=["adult","explicit","illegal","fraud","scam"],i=(e+" "+t).toLowerCase();return!a.some(s=>i.includes(s))}validateDeadline(e){if(!e)return!0;const t=new Date;return(e.toDate?e.toDate():new Date(e))>t}checkCompleteness(e){return!!(e.title&&e.description&&e.category&&e.budget)}calculateConfidence(e){const t={hasValidTitle:.15,hasValidDescription:.2,hasValidCategory:.1,hasValidBudget:.15,hasValidLocation:.05,isNotSpam:.15,isNotInappropriate:.15,hasReasonableDeadline:.05};let a=0;return Object.entries(t).forEach(([i,s])=>{e[i]&&(a+=s)}),Math.round(a*100)}generateReason(e,t){const a=[];return e.hasValidTitle||a.push("Invalid title"),e.hasValidDescription||a.push("Invalid description"),e.hasValidCategory||a.push("Invalid category"),e.hasValidBudget||a.push("Invalid budget"),e.isNotSpam||a.push("Potential spam detected"),e.isNotInappropriate||a.push("Inappropriate content detected"),e.hasReasonableDeadline||a.push("Invalid deadline"),e.isComplete||a.push("Incomplete information"),a.length===0?`High quality enquiry (${t}% confidence)`:`Issues detected: ${a.join(", ")}`}};h(n,"instance");let u=n;const C=u.getInstance();export{u as EnquiryApprovalAI,C as enquiryApprovalAI};
